#include<stdio.h>
#include<string.h>
#include<ctype.h>
#include "set.h"
int n,type,sectype,defnumber;
char word[100],definition[100],eword[100][100],i,j,k;
int main()
{
	/*
	Different type explanations:
	1 -> Straight up insert, requires name, definiton and will also add 1 to first line to specify 1 definition.
	2 -> Splits into 2 cases: 1. Update a single definition.(Will be given as a parameter in the test cases and can either be:update it, delete it or add a new one)
	                          2. Update the entire word(clear the entire file and create a new one, which goes to case 4, deletion and then to case 1, to add a new definiton)
							  3. Add a new definition for the respective word.
	3 -> Delete a word
	4 -> Look-up a word and it's definitions.
	*/
	FILE *fi = fopen("test","r");
	set_node *set;
	set_init(&set);
	fscanf(fi,"%d", &n);       // n represents the number of tests we're going to run through the program
	for (k = 1;k <= n;k++)
	{
		fscanf(fi, "%d", &type);   // The command type
		if (type == 1)             // Type 1 is for Inserting a word into the dictionary
		{																				
			fscanf(fi, "%s", word);
			fgetc(fi);
			fgets(definition, 100, fi);
			if (!(set_search(set, word, strlen(word) + 1, strcmp)))         // First, we have to check if the word already exists and if it does, we ignore the Insert command.
			{
				set_insert(&set, word, strlen(word) + 1, strcmp);           // We insert the word in the set.
				FILE *f = fopen(word, "w");																	
				fprintf(f, "1\n");											// We will use the first line of the file to store the number of definitions our word has. In the insert case, we initialize it with 1.
				fprintf(f, "%s\n", definition);								// Add the definition as the second line in the file.
				fclose(f);
			}
		}
		else  //trebuie testat ce e mai jos
			if (type == 2)
			{
				fscanf(fi, "%d", &sectype);
				fgetc(fi);
				if (sectype == 1)
					fscanf(fi, "%d", &defnumber);
				fscanf(fi, "%s", word);
				fgetc(fi);
				fgets(definition, 100, fi);
				if (sectype == 1)
				{
					if (set_search(set, word, strlen(word) + 1, strcmp))
					{
						memset(eword, ' ', sizeof(eword));
						FILE *f = fopen(word, "r");
						for (i = 0;i <= 99;i++)
							for (j = 0;j <= 99;j++)
								fscanf(f, "%c", eword[i][j]);
						for (i = 0;i <= 99;i++)
							eword[defnumber][i] = definition[i];
						fclose(f);
						FILE *g = fopen(word, "w");
						for (i = 0;i <= 99;i++)
						{
							for (j = 0;j <= 99;j++)
								fprintf(g, "%c", eword[i][j]);
							fprintf(g, "\n");
						}
						fclose(g);
					}
				}
				if (sectype == 2)
				{

				}
				if (sectype == 3)
				{

				}
			}
			else
				if (type == 3)
				{

				}
				else
					if (type == 4)
					{

					}


	}
	return 0;
}
